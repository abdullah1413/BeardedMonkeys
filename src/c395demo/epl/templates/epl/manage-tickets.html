{% extends 'epl/index.html' %}

{% block content %}

<html>
<head>
	<title>Branch Tickets</title>
	{% load static %}

	<script src="{% static '/demo/sorttable.js' %}"></script>
</head>
<body>
    <h1>Branch Tickets</h1>
	<table class="sortable">
	    <tr>
	        <th>ID</th>
	        <th>Author</th>
	        <th>Date</th>
	        <th>Category</th>
	        <th>Status</th>
	        <th>Priority</th>
	        <th class= "sorttable_nosort">Description</th>
	        <th class= "sorttable_nosort">Options</th>
	    </tr>
	    {% load descGet %}
	    {% for callLog in callLogs %}
	        {% if callLog.Category in available %}
                <tr>
                    <td> {{ callLog.CallID }} </td>
                    <td> {{ callLog.CustID }} </td>
                    <td> 20{{ callLog.RecvdDate }} </td>
                    <td> {{ callLog.Category }} </td>
                     <td id="status_{{ callLog.CallID }}"> {{ callLog.CallStatus }} </td>
                    <td> {{ callLog.Priority }} </td>
                    <td style="text-align:left;"> {% descGet callLog.CallID %} </td>
                    <td>
                        <a href="{% url 'detail' id=callLog.CallID %}" style="display:inline-block;">
                            <div class="button"><i class="fa fa-folder-open-o" aria-hidden="true"></i> View</div>
                        </a>
                        <a href="edit.asp" style="display:inline-block;">
                            <div class="button"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</div>
                        </a>

                        <!--check if the user is owner of the ticket. And if he is ownere, he can click resolve button; if not, he can't-->
                        {% if user.username == callLog.CustID %}
                            <a href="#" id="myBtn_{{ callLog.CallID }}" class="button" style="display:inline-block;"> <div>
                                {% if callLog.CallStatus == "Open" %}
                                    <i class="fa fa-check" aria-hidden="true"></i> Resolved
                                {% else %}
                                    <i class="fa fa-check" aria-hidden="true"></i> Re-open
                                {% endif %}
                            </div></a>
                        {% else %}
                            <a href="#" href="#" class="button disabled" style="background-color:grey; display:inline-block;"> <div>
                                {% if callLog.CallStatus == "Open" %}
                                    <i class="fa fa-check" aria-hidden="true"></i> Resolved
                                {% else %}
                                    <i class="fa fa-check" aria-hidden="true"></i> Re-open
                                {% endif %}
                            </div></a>
                        {% endif %}
                    </td>
                </tr>
            {% endif %}
	    {% endfor %}
    </table>
    <div id="myModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
          <span class="close">&times;</span>
          <p id="modalText">Are you sure the ticket has been resolved?</p>
          <a class="button modalButton nButton" href="#" style="float:right">No</a><!-- add class and remove id-->
          <a class="button modalButton" style="visibility:hidden;"></a>
          <a id="yButton" class="button modalButton" href="#" style="float:right; margin-right:20px;">Yes</a>
      </div>
    </div>
</body>
</html>

{% endblock %}
